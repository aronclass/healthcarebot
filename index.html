<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthCare Connect | Smart Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --opal-blue: #e8f0fe;
            --opal-green: #e6f4ea;
            --google-blue: #1a73e8;
            --google-green: #1e8e3e;
        }

        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #3c4043;
            overflow: hidden;
        }

        .opal-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.04);
            transition: transform 0.2s ease;
        }

        .chat-bubble {
            max-width: 85%;
            border-radius: 20px;
            padding: 12px 18px;
            margin-bottom: 8px;
            line-height: 1.5;
            animation: slideIn 0.3s ease-out;
        }

        .bubble-bot { background-color: var(--opal-blue); color: #174ea6; border-bottom-left-radius: 4px; }
        .bubble-user { background-color: var(--google-blue); color: white; border-bottom-right-radius: 4px; margin-left: auto; }

        .hidden-section { display: none !important; }
        .visible-section { display: flex !important; flex-direction: column; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .sidebar-item.active::after {
            content: ''; position: absolute; right: 0; top: 20%; height: 60%; width: 4px;
            background: var(--google-blue); border-radius: 4px 0 0 4px;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #dadce0; border-radius: 10px; }

        .search-container {
            animation: slideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .filter-chip {
            transition: all 0.2s;
            cursor: pointer;
        }
        .filter-chip.active {
            background-color: var(--google-blue);
            color: white;
            border-color: var(--google-blue);
        }

        #chat-view { height: 100%; position: relative; }
    </style>
</head>
<body class="flex min-h-screen">

    <!-- SIDEBAR NAVIGATION -->
    <aside class="w-20 md:w-24 bg-white border-r border-gray-100 flex flex-col items-center py-8 gap-10 fixed h-full z-50">
        <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-100 mb-4 cursor-pointer" onclick="toggleView('dashboard')">
            <i class="fas fa-hand-holding-medical text-xl"></i>
        </div>
        <div class="flex flex-col gap-8 flex-grow">
            <button id="nav-dashboard" onclick="toggleView('dashboard')" class="sidebar-item active flex flex-col items-center gap-1 text-blue-600 group relative">
                <div class="p-3 rounded-2xl group-hover:bg-blue-50 transition-colors"><i class="fas fa-home text-lg"></i></div>
                <span class="text-[10px] font-bold">Home</span>
            </button>
            <button id="nav-chat" onclick="startChat('general')" class="sidebar-item flex flex-col items-center gap-1 text-gray-400 group relative">
                <div class="p-3 rounded-2xl group-hover:bg-blue-50 transition-colors"><i class="fas fa-comment-dots text-lg"></i></div>
                <span class="text-[10px] font-bold">Chat</span>
            </button>
            <button id="nav-agenda" onclick="toggleView('agenda')" class="sidebar-item flex flex-col items-center gap-1 text-gray-400 group relative">
                <div class="p-3 rounded-2xl group-hover:bg-blue-50 transition-colors"><i class="fas fa-calendar-check text-lg"></i></div>
                <span class="text-[10px] font-bold">Appointments</span>
            </button>
            <button id="nav-payment" onclick="toggleView('payment')" class="sidebar-item flex flex-col items-center gap-1 text-gray-400 group relative">
                <div class="p-3 rounded-2xl group-hover:bg-blue-50 transition-colors">
                    <i class="fas fa-credit-card text-lg"></i>
                    <div id="payment-badge" class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></div>
                </div>
                <span class="text-[10px] font-bold">Payments</span>
            </button>
        </div>
    </aside>

    <main class="flex-grow ml-20 md:ml-24 w-full flex flex-col h-screen overflow-hidden">
        <!-- Header -->
        <header class="p-6 flex items-center justify-between bg-white/80 backdrop-blur-md border-b border-gray-50">
            <div>
                <h1 id="view-title" class="text-xl font-bold text-gray-800">Home</h1>
                <p id="view-subtitle" class="text-xs text-gray-500">Healthcare Assistant</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p class="text-xs font-bold text-gray-800 leading-none">Alex Johnson</p>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Patient ID: 8829</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-blue-100 overflow-hidden ring-2 ring-blue-50">
                    <img src="https://ui-avatars.com/api/?name=Alex+Johnson&background=1a73e8&color=fff" alt="Profile">
                </div>
            </div>
        </header>

        <!-- Dynamic Main Content Area -->
        <div class="flex-grow overflow-y-auto custom-scrollbar p-4 md:p-8 w-full relative">
            
            <!-- DASHBOARD: Dynamically resizes based on max-width for desktop -->
            <section id="dashboard-view" class="visible-section space-y-8 h-full max-w-6xl mx-auto">
                <!-- Main Health Card -->
                <div class="p-6 md:p-10 bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 rounded-3xl relative overflow-hidden flex flex-col md:flex-row items-center gap-8 text-white shadow-lg">
                    <div class="flex-grow space-y-4">
                        <div class="inline-block bg-white/20 backdrop-blur px-3 py-1 rounded-full text-xs font-bold">HEALTH SCORE: 95%</div>
                        <h2 class="text-4xl md:text-5xl font-bold">Feeling good today?</h2>
                        <p class="text-white/90 max-w-md text-sm">You've completed 80% of your daily health goals. Your next appointment is in 2 days.</p>
                        <div class="flex flex-wrap gap-4 mt-8">
                            <button onclick="startChat('book')" class="bg-white text-blue-600 px-8 py-3 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all hover:bg-blue-50">
                                New Booking
                            </button>
                            <button onclick="startChat('symptoms')" class="bg-white/20 backdrop-blur text-white px-8 py-3 rounded-2xl font-bold border border-white/30 hover:bg-white/30 transition-all">
                                Check Symptoms
                            </button>
                        </div>
                    </div>
                    <!-- Decorative Element -->
                    <div class="hidden lg:flex w-40 h-40 bg-white/10 rounded-full items-center justify-center text-white text-5xl">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>

                <!-- Activity Progress Section -->
                <div>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-6 px-2">Activity Progress</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <!-- Steps -->
                        <div class="text-center">
                            <div class="relative w-24 h-24 mx-auto mb-3">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#3b82f6" stroke-width="8" stroke-dasharray="226.19 301.59" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-gray-800">9.4k</span>
                                </div>
                            </div>
                            <p class="text-xs font-bold text-gray-500 uppercase">Steps</p>
                        </div>
                        <!-- Water -->
                        <div class="text-center">
                            <div class="relative w-24 h-24 mx-auto mb-3">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#10b981" stroke-width="8" stroke-dasharray="151.06 301.59" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-gray-800">1.2L</span>
                                </div>
                            </div>
                            <p class="text-xs font-bold text-gray-500 uppercase">Water</p>
                        </div>
                        <!-- Sleep -->
                        <div class="text-center">
                            <div class="relative w-24 h-24 mx-auto mb-3">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#fbbf24" stroke-width="8" stroke-dasharray="192.13 301.59" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-gray-800">7.2h</span>
                                </div>
                            </div>
                            <p class="text-xs font-bold text-gray-500 uppercase">Sleep</p>
                        </div>
                        <!-- Kcal -->
                        <div class="text-center">
                            <div class="relative w-24 h-24 mx-auto mb-3">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#ef4444" stroke-width="8" stroke-dasharray="75.40 301.59" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-gray-800">520</span>
                                </div>
                            </div>
                            <p class="text-xs font-bold text-gray-500 uppercase">Kcal</p>
                        </div>
                    </div>
                </div>

                <!-- Meds and Assistant Cards -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Meds Card -->
                    <div class="opal-card p-6 bg-white border-l-4 border-amber-400">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="font-bold text-xs text-gray-400 uppercase">Meds</h4>
                            <span class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded-full">Next: 2 PM</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center text-lg">üíä</div>
                            <div>
                                <p class="font-bold text-gray-800 text-sm">Vitamin D3</p>
                                <p class="text-xs text-gray-500">Capsules ‚Ä¢ Daily</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Assistant Card -->
                    <div class="opal-card p-6 bg-white border-l-4 border-blue-400">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 flex-shrink-0">
                                <i class="fas fa-brain text-sm"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-xs text-gray-400 uppercase mb-2">AI Assistant</h4>
                                <p class="text-gray-700 text-xs italic">"Your active recovery is looking good. Try to get 15 more minutes of movement today."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mindfulness Card -->
                <div class="opal-card p-6 bg-white border-l-4 border-purple-400">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 flex-shrink-0">
                            <i class="fas fa-spa text-sm"></i>
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-bold text-xs text-gray-400 uppercase mb-2">Mindfulness</h4>
                            <p class="text-gray-700 text-sm font-medium mb-3">Daily Focus: Guided 5-min meditation</p>
                            <button onclick="startChat('general')" class="text-xs font-bold text-purple-600 hover:text-purple-700">Start Session ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Appointment Message -->
                <div class="bg-blue-50 border border-blue-200 rounded-2xl p-4 text-center">
                    <p class="text-sm text-blue-700 font-medium">I can help you schedule an appointment. First, please choose a healthcare facility:</p>
                </div>
            </section>

            <!-- CHAT INTERFACE: Centered for readability -->
            <section id="chat-view" class="hidden-section h-full max-w-3xl mx-auto">
                <div id="chat-messages" class="flex-grow overflow-y-auto px-2 space-y-4 custom-scrollbar pb-6 min-h-[300px]">
                    <!-- Messages populate here -->
                </div>

                <!-- Step 1: Hospital Search -->
                <div id="hospital-search-ui" class="hidden search-container space-y-3 bg-white p-4 rounded-3xl border border-blue-100 shadow-xl shadow-blue-50 mb-4">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                        <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Step 1: Choose Facility</h4>
                    </div>
                    <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                        <span onclick="filterHospitals('All')" class="filter-chip active text-[10px] font-bold px-3 py-1 rounded-full border border-gray-200 whitespace-nowrap">All</span>
                        <span onclick="filterHospitals('Hospital')" class="filter-chip text-[10px] font-bold px-3 py-1 rounded-full border border-gray-200 whitespace-nowrap">Hospitals</span>
                        <span onclick="filterHospitals('Clinic')" class="filter-chip text-[10px] font-bold px-3 py-1 rounded-full border border-gray-200 whitespace-nowrap">Clinics</span>
                    </div>
                    <div class="relative">
                        <input type="text" id="hospital-query" oninput="searchHospitals()" placeholder="Search Hospital or Clinic name..." class="w-full p-4 bg-gray-50 rounded-2xl text-sm border-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-300"></i>
                    </div>
                    <div id="hospital-results" class="max-h-40 overflow-y-auto space-y-2 pt-2 custom-scrollbar">
                        <!-- JS populated -->
                    </div>
                </div>

                <!-- Step 2: Doctor Search -->
                <div id="doctor-search-ui" class="hidden search-container space-y-3 bg-white p-4 rounded-3xl border border-green-100 shadow-xl shadow-green-50 mb-4">
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Step 2: Choose Doctor</h4>
                        </div>
                        <button onclick="backToHospitals()" class="text-[10px] font-bold text-blue-600 hover:underline">Change Facility</button>
                    </div>
                    <div class="relative">
                        <input type="text" id="doctor-query" oninput="searchDoctors()" placeholder="Search by name or specialty..." class="w-full p-4 bg-gray-50 rounded-2xl text-sm border-none focus:ring-2 focus:ring-green-500">
                        <i class="fas fa-user-md absolute right-4 top-1/2 -translate-y-1/2 text-gray-300"></i>
                    </div>
                    <div id="doctor-results" class="max-h-40 overflow-y-auto space-y-2 pt-2 custom-scrollbar">
                        <!-- JS populated -->
                    </div>
                </div>

                <!-- Input area fixed to bottom of chat -->
                <div id="action-area" class="bg-white rounded-3xl p-3 shadow-2xl border border-gray-100 mt-auto sticky bottom-0 z-10">
                    <div id="quick-replies" class="flex gap-2 overflow-x-auto pb-3 no-scrollbar mb-2 px-1">
                        <!-- Suggestions here -->
                    </div>
                    <div class="relative flex items-center">
                        <input type="text" id="user-input" placeholder="Type a message..." class="w-full p-4 pr-16 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <button onclick="handleSend()" class="absolute right-2 w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center transition-transform active:scale-90">
                            <i class="fas fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- APPOINTMENTS VIEW -->
            <section id="agenda-view" class="hidden-section w-full max-w-4xl mx-auto space-y-6">
                <h2 class="text-2xl font-bold px-2">Appointments</h2>
                <div id="agenda-list" class="grid grid-cols-1 gap-4"></div>
                <div id="empty-agenda" class="flex flex-col items-center py-24 text-center">
                    <i class="fas fa-calendar-day text-gray-200 text-4xl mb-4"></i>
                    <p class="font-bold text-gray-800">Your schedule is clear</p>
                </div>
            </section>

            <!-- PAYMENTS VIEW -->
            <section id="payment-view" class="hidden-section w-full max-w-md mx-auto space-y-6">
                <h2 class="text-2xl font-bold px-2">Payments & Invoices</h2>
                <div id="invoice-card" class="opal-card p-8 bg-white space-y-6">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 mx-auto mb-4">
                            <i class="fas fa-file-invoice-dollar text-2xl"></i>
                        </div>
                        <p class="text-gray-500 text-sm">Current Balance</p>
                        <h3 id="payment-amount" class="text-4xl font-bold text-gray-900 mt-1">$120.00</h3>
                    </div>

                    <div id="payment-details-container" class="space-y-4">
                        <div class="flex justify-between items-center pb-4 border-b border-gray-50">
                            <div>
                                <p class="font-bold text-gray-800">Consultation Fee</p>
                                <p class="text-xs text-gray-500">Dr. Sarah Jenkins - Jan 02, 2026</p>
                            </div>
                            <p class="font-bold text-gray-700">$120.00</p>
                        </div>
                        
                        <div id="payment-status-row" class="flex justify-between items-center py-2">
                            <p class="text-sm font-medium text-gray-600">Status</p>
                            <span id="payment-status-badge" class="px-3 py-1 bg-amber-100 text-amber-700 text-[10px] font-bold rounded-full uppercase tracking-wider">Pending</span>
                        </div>

                        <div id="payment-action-container">
                            <button id="pay-now-btn" onclick="processPayment()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-emerald-100 hover:bg-emerald-700 transition-all flex items-center justify-center gap-2">
                                <span>Pay Now</span>
                                <i class="fas fa-arrow-right text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="payment-history" class="p-2">
                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">History</h4>
                    <div id="history-list" class="space-y-3 opacity-50">
                        <div class="flex justify-between items-center bg-gray-50 p-4 rounded-2xl text-sm">
                            <p class="text-gray-600">Blood Test - Nov 2025</p>
                            <p class="font-bold">$45.00</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- BOOKING MODAL -->
    <div id="booking-form-overlay" class="fixed inset-0 bg-blue-900/10 backdrop-blur-md z-[100] hidden items-center justify-center p-4">
        <div class="opal-card w-full max-w-md p-8 bg-white animate-fadeIn">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Confirm Visit</h2>
                <button onclick="closeBooking()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div id="booking-details-box" class="p-4 bg-blue-50 rounded-2xl mb-4">
                    <p id="modal-doc-name" class="font-bold text-blue-800">Doctor Name</p>
                    <p id="modal-facility" class="text-xs text-blue-600">Facility Name</p>
                </div>
                <input type="date" id="appt-date" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                <select id="appt-time" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                    <option>09:00 AM</option><option>11:00 AM</option><option>02:00 PM</option>
                </select>
                <button onclick="finalizeBooking()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg">Finalize Appointment</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const hospitals = [
            { id: 101, name: "City General Hospital", type: "Hospital", address: "Downtown Area" },
            { id: 102, name: "St. Mary Medical Center", type: "Hospital", address: "Upper East" },
            { id: 103, name: "Wellness Point Clinic", type: "Clinic", address: "Riverside" },
            { id: 104, name: "Family Health Practice", type: "Clinic", address: "Suburbs" },
            { id: 105, name: "Dr. Smith's Private Office", type: "Private", address: "Health Street" }
        ];

        const doctors = [
            { id: 1, name: "Dr. Sarah Jenkins", specialty: "Cardiologist", facilityId: 101 },
            { id: 2, name: "Dr. Marcus Thorne", specialty: "Neurologist", facilityId: 101 },
            { id: 3, name: "Dr. Elena Rodriguez", specialty: "Pediatrician", facilityId: 102 },
            { id: 4, name: "Dr. James Wilson", specialty: "Dermatologist", facilityId: 103 },
            { id: 5, name: "Dr. Lisa Wang", specialty: "General Practitioner", facilityId: 104 }
        ];

        let appointments = [];
        let currentState = { hospital: null, doctor: null, filter: 'All', paid: false };

        // --- CORE UI ---
        function toggleView(view) {
            const views = ['dashboard', 'chat', 'agenda', 'payment'];
            views.forEach(v => {
                const el = document.getElementById(`${v}-view`);
                const nav = document.getElementById(`nav-${v}`);
                
                if (el && nav) {
                    if (v === view) {
                        el.classList.remove('hidden-section');
                        el.classList.add('visible-section');
                        nav.classList.add('text-blue-600', 'active');
                        nav.classList.remove('text-gray-400');
                    } else {
                        el.classList.add('hidden-section');
                        el.classList.remove('visible-section');
                        nav.classList.remove('text-blue-600', 'active');
                        nav.classList.add('text-gray-400');
                    }
                }
            });
            
            if (view === 'agenda') renderAgenda();
            if (view === 'payment') updatePaymentUI();
            
            document.getElementById('view-title').innerText = view.charAt(0).toUpperCase() + view.slice(1);
        }

        function updatePaymentUI() {
            const badge = document.getElementById('payment-badge');
            const statusBadge = document.getElementById('payment-status-badge');
            const payBtn = document.getElementById('pay-now-btn');
            const amountText = document.getElementById('payment-amount');
            const dashPayBtn = document.getElementById('dash-pay-btn');

            if (currentState.paid) {
                badge.classList.add('hidden');
                statusBadge.innerText = 'Paid';
                statusBadge.classList.remove('bg-amber-100', 'text-amber-700');
                statusBadge.classList.add('bg-emerald-100', 'text-emerald-700');
                amountText.innerText = '$0.00';
                amountText.classList.add('text-emerald-600');
                payBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Invoice Cleared';
                payBtn.classList.replace('bg-emerald-600', 'bg-gray-100');
                payBtn.classList.replace('text-white', 'text-gray-400');
                payBtn.disabled = true;
                if(dashPayBtn) dashPayBtn.classList.add('hidden');
            }
        }

        function processPayment() {
            const payBtn = document.getElementById('pay-now-btn');
            payBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
            payBtn.disabled = true;

            setTimeout(() => {
                currentState.paid = true;
                updatePaymentUI();
                
                // Show success in chat as feedback
                addMessage("‚úÖ Payment of **$120.00** successful! Your account is now clear.", 'bot');
                toggleView('payment');
                
                // Add to history list UI
                const historyList = document.getElementById('history-list');
                const newEntry = document.createElement('div');
                newEntry.className = "flex justify-between items-center bg-blue-50 p-4 rounded-2xl text-sm border border-blue-100";
                newEntry.innerHTML = `<p class="text-blue-700 font-bold">Consultation Fee - Jan 2026</p><p class="font-bold text-blue-700">$120.00</p>`;
                historyList.prepend(newEntry);
                historyList.classList.remove('opacity-50');
            }, 1500);
        }

        // --- CHAT LOGIC ---
        function addMessage(text, sender = 'bot') {
            const container = document.getElementById('chat-messages');
            if (!container) return;
            const div = document.createElement('div');
            div.className = `chat-bubble ${sender === 'bot' ? 'bubble-bot' : 'bubble-user'}`;
            div.innerHTML = text;
            container.appendChild(div);
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        }

        function startChat(mode) {
            toggleView('chat');
            document.getElementById('chat-messages').innerHTML = '';
            
            document.getElementById('hospital-search-ui').classList.add('hidden');
            document.getElementById('doctor-search-ui').classList.add('hidden');

            if (mode === 'book') {
                addMessage("I'll help you book an appointment. First, please search for or select a **Hospital or Clinic**.");
                showHospitalSearch();
                setSuggestions(["How to book?", "Check Symptoms", "My Profile"]);
            } else if (mode === 'symptoms') {
                addMessage("I'm in ‚ú® Symptom Checker mode. Tell me what you're feeling, and I'll recommend the right specialist.");
                setSuggestions(["Feeling dizzy", "Back pain", "Headache", "Exit"]);
            } else if (mode === 'onboarding') {
                addMessage("Hello Alex! üëã I'm your HealthCare Assistant. You have 1 pending payment. Would you like to handle that or book an appointment?");
                setSuggestions(["Pay Bill", "Book Appointment", "Check Symptoms"]);
            } else {
                addMessage("Hello! üëã I'm HealthCare Connect. I can help you guide through booking or checking symptoms. What would you like to do?");
                setSuggestions(["Book Appointment", "Make Payment", "Show My Schedule"]);
            }
        }

        function setSuggestions(list) {
            const container = document.getElementById('quick-replies');
            if (!container) return;
            container.innerHTML = list.map(label => `
                <button onclick="handleSuggestion('${label}')" class="whitespace-nowrap px-4 py-2 bg-gray-50 rounded-full text-xs font-bold text-gray-500 hover:bg-blue-600 hover:text-white transition-all shadow-sm border border-gray-100">
                    ${label}
                </button>
            `).join('');
        }

        function handleSuggestion(label) {
            addMessage(label, 'user');
            if (label.toLowerCase().includes("book")) startChat('book');
            else if (label.toLowerCase().includes("symptoms")) startChat('symptoms');
            else if (label.toLowerCase().includes("pay") || label.toLowerCase().includes("payment")) toggleView('payment');
            else if (label.toLowerCase().includes("schedule")) toggleView('agenda');
            else if (label.toLowerCase().includes("home")) toggleView('dashboard');
            else handleSend(label);
        }

        async function handleSend(manualInput = null) {
            const input = document.getElementById('user-input');
            const val = manualInput || input.value.trim();
            if (!val) return;
            if (!manualInput) {
                addMessage(val, 'user');
                input.value = '';
            }

            if (val.toLowerCase().includes("book")) {
                startChat('book');
            } else if (val.toLowerCase().includes("symptom")) {
                startChat('symptoms');
            } else if (val.toLowerCase().includes("pay")) {
                toggleView('payment');
            } else {
                setTimeout(() => addMessage("I understand. To get started, you can use the suggestions below to book or check health issues."), 500);
            }
        }

        // --- SEARCH LOGIC ---
        function showHospitalSearch() {
            const ui = document.getElementById('hospital-search-ui');
            if (ui) {
                ui.classList.remove('hidden');
                document.getElementById('doctor-search-ui').classList.add('hidden');
                searchHospitals();
            }
        }

        function filterHospitals(type) {
            currentState.filter = type;
            document.querySelectorAll('.filter-chip').forEach(c => {
                c.classList.remove('active');
                if (c.innerText === type || (type === 'All' && c.innerText === 'All')) c.classList.add('active');
            });
            searchHospitals();
        }

        function searchHospitals() {
            const query = document.getElementById('hospital-query').value.toLowerCase();
            const results = document.getElementById('hospital-results');
            results.innerHTML = '';

            const filtered = hospitals.filter(h => 
                (currentState.filter === 'All' || h.type === currentState.filter) &&
                h.name.toLowerCase().includes(query)
            );

            filtered.forEach(h => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-blue-50 cursor-pointer transition-colors border border-transparent hover:border-blue-200";
                div.innerHTML = `
                    <div>
                        <p class="text-sm font-bold text-gray-800">${h.name}</p>
                        <p class="text-[10px] text-gray-500">${h.type} ‚Ä¢ ${h.address}</p>
                    </div>
                    <i class="fas fa-chevron-right text-xs text-blue-400"></i>
                `;
                div.onclick = () => selectHospital(h);
                results.appendChild(div);
            });
        }

        function selectHospital(h) {
            currentState.hospital = h;
            addMessage(`Selected **${h.name}**. Now, please choose a doctor from this facility.`);
            document.getElementById('hospital-search-ui').classList.add('hidden');
            document.getElementById('doctor-search-ui').classList.remove('hidden');
            searchDoctors();
        }

        function backToHospitals() {
            currentState.hospital = null;
            document.getElementById('doctor-search-ui').classList.add('hidden');
            document.getElementById('hospital-search-ui').classList.remove('hidden');
        }

        function searchDoctors() {
            const queryEl = document.getElementById('doctor-query');
            const query = queryEl ? queryEl.value.toLowerCase() : "";
            const results = document.getElementById('doctor-results');
            results.innerHTML = '';

            const filtered = doctors.filter(d => 
                d.facilityId === currentState.hospital.id &&
                (d.name.toLowerCase().includes(query) || d.specialty.toLowerCase().includes(query))
            );

            filtered.forEach(d => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-green-50 cursor-pointer transition-colors border border-transparent hover:border-green-200";
                div.innerHTML = `
                    <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center text-lg shadow-sm">üë®‚Äç‚öïÔ∏è</div>
                    <div class="flex-grow">
                        <p class="text-sm font-bold text-gray-800">${d.name}</p>
                        <p class="text-[10px] text-gray-500">${d.specialty}</p>
                    </div>
                    <button class="bg-green-600 text-white px-3 py-1 rounded-lg text-[10px] font-bold">Book</button>
                `;
                div.onclick = () => openBooking(d);
                results.appendChild(div);
            });
        }

        function openBooking(doc) {
            currentState.doctor = doc;
            document.getElementById('modal-doc-name').innerText = doc.name;
            document.getElementById('modal-facility').innerText = currentState.hospital.name;
            document.getElementById('booking-form-overlay').classList.remove('hidden');
            document.getElementById('booking-form-overlay').classList.add('flex');
        }

        function closeBooking() {
            document.getElementById('booking-form-overlay').classList.add('hidden');
            document.getElementById('booking-form-overlay').classList.remove('flex');
        }

        function finalizeBooking() {
            const date = document.getElementById('appt-date').value;
            const time = document.getElementById('appt-time').value;
            if (!date) return;

            appointments.push({
                id: Math.random().toString(36).substr(2, 5).toUpperCase(),
                doctor: currentState.doctor,
                hospital: currentState.hospital,
                date, time
            });

            closeBooking();
            addMessage(`‚úÖ Success! Your appointment with **${currentState.doctor.name}** is confirmed for **${date}** at **${time}**.`);
            document.getElementById('doctor-search-ui').classList.add('hidden');
            setSuggestions(["View Schedule", "Book Another", "Home"]);
        }

        function renderAgenda() {
            const list = document.getElementById('agenda-list');
            const empty = document.getElementById('empty-agenda');
            if (!list) return;
            list.innerHTML = '';

            if (appointments.length === 0) {
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            appointments.forEach(app => {
                const div = document.createElement('div');
                div.className = "opal-card p-5 bg-white flex items-center gap-4 animate-fadeIn";
                div.innerHTML = `
                    <div class="bg-blue-50 text-blue-600 p-3 rounded-xl text-center min-w-[60px]">
                        <p class="text-[10px] font-bold uppercase">${new Date(app.date).toLocaleString('default', { month: 'short' })}</p>
                        <p class="text-xl font-bold">${new Date(app.date).getDate()}</p>
                    </div>
                    <div class="flex-grow">
                        <p class="font-bold text-gray-800">${app.doctor.name}</p>
                        <p class="text-[10px] text-gray-500">${app.hospital.name} ‚Ä¢ ${app.time}</p>
                    </div>
                    <button onclick="cancelAppt('${app.id}')" class="text-red-400 p-2 hover:text-red-600 transition-colors"><i class="fas fa-trash-alt"></i></button>
                `;
                list.appendChild(div);
            });
        }

        function cancelAppt(id) {
            appointments = appointments.filter(a => a.id !== id);
            renderAgenda();
        }

        window.onload = () => {
            toggleView('dashboard');
            const input = document.getElementById('user-input');
            if (input) {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleSend();
                });
            }
            // Auto-start onboarding chat
            startChat('onboarding');
        };
    </script>
</body>
</html>
