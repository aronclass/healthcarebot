<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Bot</title>
    <!-- Google Fonts - Outfit for display, Roboto for body -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define CSS variables for theme consistency */
        :root {
            --background-color: #f4f7f6;
            --accent-color: #2196F3; /* Muted blue */
            --primary-color: #4CAF50; /* Green */
            --primary-dark-color: #388E3C; /* Darker Green */
            --text-color: #333;
            --light-text-color: #666;
            --card-background: #ffffff;
            --border-color: #ddd;
            --chat-bubble-user: #e0f7fa; /* Light cyan */
            --chat-bubble-bot: #fff;
            --chat-input-bg: #f9f9f9;
        }

        /* Base styles, using CSS variables for colors */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', sans-serif; /* Body font */
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-y: auto;
        }

        #app {
            background-color: var(--card-background);
            border-radius: 1.5rem; /* Large, premium border-radius */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1); /* Soft, deep shadow */
            max-width: 96%; /* Responsive width */
            width: 1200px; /* Max width for desktop */
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Ensures child elements respect border-radius */
            margin: 1.5rem 0; /* Vertical margin for smaller screens */
        }

        @media (min-width: 768px) {
            #app {
                width: 900px;
                min-height: 85vh;
                max-width: 900px;
            }
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 1.5rem;
            border-top-right-radius: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle header shadow */
            position: sticky; /* Fixed header */
            top: 0;
            z-index: 10;
        }

        header h1 {
            font-family: 'Outfit', sans-serif; /* Display font for headings */
            font-weight: 700;
            font-size: 1.8rem;
            letter-spacing: -0.025em; /* Modern, slightly tighter letter spacing */
        }

        nav button {
            background-color: var(--primary-dark-color);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.75rem;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        nav button:hover {
            background-color: var(--accent-color); /* Hover to accent blue */
            transform: translateY(-2px); /* Lift effect */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        main {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto; /* Scrollable content area */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .page {
            display: none;
            width: 100%;
            flex-direction: column;
            flex-grow: 1;
            padding-bottom: 2rem; /* Spacing for scrollable content */
        }

        .page.active {
            display: flex;
        }

        #loginPage.active {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding-bottom: 0;
        }

        .form-container {
            background-color: var(--card-background);
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
            box-sizing: border-box;
        }
        @media (max-width: 768px) {
            .form-container {
                max-width: 95%;
                padding: 2rem;
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 1.05rem;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 1rem;
            color: var(--text-color);
            background-color: var(--background-color); /* Light background for inputs */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="password"]:focus,
        .form-group select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2); /* Accent blue focus ring */
        }

        .radio-group {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 400;
            color: var(--light-text-color);
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .radio-group label:hover {
            color: var(--text-color);
        }

        .radio-group input[type="radio"] {
            margin-right: 0.6rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: border-color 0.3s ease;
        }

        .radio-group input[type="radio"]:checked {
            border-color: var(--primary-color);
        }

        .radio-group input[type="radio"]:checked::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: var(--primary-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark-color)); /* Smooth gradient */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Soft shadow */
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark-color), var(--primary-color)); /* Reverse gradient on hover */
            transform: translateY(-3px); /* Stronger lift effect */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .search-bar-container {
            margin-bottom: 2rem;
            position: relative;
            width: 100%;
        }

        .search-bar-container input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 1.1rem;
            color: var(--text-color);
            background-color: var(--background-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            padding-left: 3rem; /* Space for search icon */
        }

        .search-bar-container input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        .search-bar-container .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text-color);
            font-size: 1.2rem;
        }

        .card-list-container {
            flex-grow: 1;
        }

        .card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem; /* Generous gap for clean layout */
            padding-top: 0.5rem;
        }

        .card {
            background-color: var(--card-background);
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Lighter, subtle shadow */
            padding: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            border: 1px solid transparent; /* Invisible border for hover effect */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-8px); /* Pronounced lift effect */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* More prominent shadow */
            border-color: var(--accent-color); /* Accent border on hover */
        }

        .card h3 {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 1.4rem;
            color: var(--primary-color); /* Primary color for card titles */
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .card p {
            font-size: 0.95rem;
            color: var(--light-text-color);
            line-height: 1.6;
        }

        .card p strong {
            color: var(--text-color);
            font-weight: 500;
        }

        .card .doctor-specialty {
            font-style: italic;
            color: var(--accent-color);
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .chatbot-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background-color: var(--card-background);
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .chatbot-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 0.9rem 1.2rem;
            border-radius: 1.2rem; /* Soft, rounded corners */
            line-height: 1.5;
            font-size: 0.95rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .message.user {
            background-color: var(--chat-bubble-user);
            color: var(--text-color);
            align-self: flex-end;
            border-bottom-right-radius: 0.3rem; /* Subtle angular touch */
        }

        .message.bot {
            background-color: var(--chat-bubble-bot);
            color: var(--text-color);
            align-self: flex-start;
            border: 1px solid var(--border-color); /* Bot messages have a subtle border */
            border-bottom-left-radius: 0.3rem; /* Subtle angular touch */
        }

        .chat-input-container {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
            background-color: var(--chat-input-bg); /* Light background for input area */
        }

        .chat-input-container input {
            flex-grow: 1;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 1rem;
            background-color: white;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .chat-input-container input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        .chat-input-container button {
            background-color: var(--accent-color);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-input-container button:hover {
            background-color: #1976D2; /* Darker accent on hover */
            transform: translateY(-1px);
        }

        /* Generic icon placeholder styling */
        .icon {
            display: inline-block;
            vertical-align: middle;
            font-size: 1.2em;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            #app {
                border-radius: 0; /* Full screen on mobile */
                margin: 0;
                max-width: 100%;
                min-height: 100vh;
            }

            header {
                flex-direction: column;
                padding: 1rem;
                border-radius: 0;
                text-align: center;
            }

            header h1 {
                margin-bottom: 0.8rem;
                font-size: 1.6rem;
            }

            nav {
                width: 100%;
                display: flex;
                justify-content: center;
                gap: 0.75rem;
            }

            nav button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            main {
                padding: 1rem;
            }

            .form-container {
                padding: 1.5rem;
                border-radius: 1rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-group label {
                margin-bottom: 0.4rem;
                font-size: 0.95rem;
            }

            .form-group input, .form-group select {
                padding: 0.7rem 0.8rem;
                font-size: 0.9rem;
            }

            .radio-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }

            .btn-primary {
                padding: 0.8rem 1rem;
                font-size: 1rem;
            }

            .search-bar-container {
                margin-bottom: 1.5rem;
            }

            .search-bar-container input {
                padding: 0.8rem 1rem;
                padding-left: 2.5rem;
                font-size: 0.95rem;
            }

            .search-bar-container .search-icon {
                left: 0.8rem;
                font-size: 1.1rem;
            }

            .card-list {
                grid-template-columns: 1fr; /* Single column on mobile */
                gap: 1rem;
            }

            .card {
                padding: 1rem;
                border-radius: 0.75rem;
            }

            .card h3 {
                font-size: 1.2rem;
            }

            .card p {
                font-size: 0.85rem;
            }

            .chatbot-header {
                padding: 0.8rem 1rem;
                font-size: 1.3rem;
            }

            .chat-messages {
                padding: 1rem;
                gap: 0.8rem;
            }

            .message {
                padding: 0.7rem 1rem;
                font-size: 0.85rem;
                max-width: 90%;
            }

            .chat-input-container {
                padding: 0.8rem 1rem;
                gap: 0.8rem;
            }

            .chat-input-container input {
                padding: 0.7rem 0.8rem;
                font-size: 0.9rem;
            }

            .chat-input-container button {
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="relative">
        <header>
            <h1 id="appTitle">Healthcare Bot</h1>
            <nav>
                <button id="backToHospitalsBtn" class="hidden">Back to Hospitals</button>
                <button id="backToDoctorsBtn" class="hidden">Back to Doctors</button>
                <button id="logoutBtn" class="hidden">Logout</button>
            </nav>
        </header>

        <main>
            <!-- Login Page -->
            <section id="loginPage" class="page active">
                <div class="form-container">
                    <h2 class="text-3xl font-display font-bold text-center mb-6 text-primary-green">Welcome to <span id="loginAppTitle">Healthcare Bot</span></h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="username">Username:</label>
                            <input type="text" id="username" name="username" placeholder="Enter your username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input type="password" id="password" name="password" placeholder="Enter your password" required>
                        </div>
                        <div class="form-group">
                            <label>Login As:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="role" value="patient" checked> Patient</label>
                                <label><input type="radio" name="role" value="doctor"> Doctor</label>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary mt-4">Login</button>
                    </form>
                </div>
            </section>

            <!-- Hospital Search Page -->
            <section id="hospitalSearchPage" class="page">
                <div class="search-bar-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="hospitalSearchInput" placeholder="Search hospitals by name or location...">
                </div>
                <div id="hospitalListDiv" class="card-list-container">
                    <div class="card-list"></div>
                    <p id="noHospitalsFound" class="hidden text-center text-text-light mt-8 text-lg">No hospitals found matching your search.</p>
                </div>
            </section>

            <!-- Doctor Search Page -->
            <section id="doctorSearchPage" class="page">
                <h2 id="selectedHospitalName" class="text-2xl font-display font-semibold mb-6 text-primary-green">Doctors at [Hospital Name]</h2>
                <div class="search-bar-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="doctorSearchInput" placeholder="Search doctors by name or specialty...">
                </div>
                <div id="doctorListDiv" class="card-list-container">
                    <div class="card-list"></div>
                    <p id="noDoctorsFound" class="hidden text-center text-text-light mt-8 text-lg">No doctors found matching your criteria in this hospital.</p>
                </div>
            </section>

            <!-- Chatbot Page -->
            <section id="chatbotPage" class="page flex-col">
                <div class="chatbot-container">
                    <div class="chatbot-header">
                        <span id="chatbotDoctorName">Chat with Dr. [Doctor Name]</span>
                    </div>
                    <div id="chatMessages" class="chat-messages">
                        <!-- Chat messages will be rendered here -->
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off">
                        <button id="sendChatBtn">Send <span class="icon">‚úâÔ∏è</span></button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Tailwind CSS configuration extension
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Mapping custom CSS variables to Tailwind color names
                        'background-light': 'var(--background-color)',
                        'accent-blue': 'var(--accent-color)',
                        'primary-green': 'var(--primary-color)',
                        'primary-dark-green': 'var(--primary-dark-color)',
                        'text-dark': 'var(--text-color)',
                        'text-light': 'var(--light-text-color)',
                        'card-bg': 'var(--card-background)',
                        'border-light': 'var(--border-color)',
                        'chat-user-bubble': 'var(--chat-bubble-user)',
                        'chat-bot-bubble': 'var(--chat-bubble-bot)',
                        'chat-input-bg-light': 'var(--chat-input-bg)',
                    },
                    fontFamily: {
                        // Custom font families
                        display: ['Outfit', 'Segoe UI', 'sans-serif'], // For headers
                        body: ['Roboto', 'Segoe UI', 'sans-serif'],   // For body text
                    }
                }
            }
        }
    </script>

    <script>
        const APP_NAME = "Healthcare Bot";

        // --- Data ---
        const hospitalData = [
            {
                rank: 1,
                name: "Apollo Hospital",
                displayName: "Apollo Hospital",
                location: "New Delhi",
                score: 85,
                opdHours: "9 AM - 5 PM",
                primaryDoctorQualifications: "MD, FRCS",
            },
            {
                rank: 2,
                name: "Fortis Hospital",
                displayName: "Fortis Hospital",
                location: "Gurgaon",
                score: 92,
                opdHours: "8 AM - 6 PM",
                primaryDoctorQualifications: "MBBS, MS, M.Ch",
            },
            {
                rank: 3,
                name: "Max Healthcare",
                displayName: "Max Healthcare",
                location: "Noida",
                score: 88,
                opdHours: "10 AM - 4 PM",
                primaryDoctorQualifications: "MD, DM",
            },
            {
                rank: 4,
                name: "AIIMS",
                displayName: "AIIMS (All India Institute of Medical Sciences)",
                location: "New Delhi",
                score: 95,
                opdHours: "9 AM - 1 PM",
                primaryDoctorQualifications: "MD, DNB, DM",
            },
            {
                rank: 5,
                name: "Manipal Hospital",
                displayName: "Manipal Hospital",
                location: "Bangalore",
                score: 89,
                opdHours: "9:30 AM - 5:30 PM",
                primaryDoctorQualifications: "MBBS, MD",
            },
            {
                rank: 6,
                name: "Kokilaben Dhirubhai Ambani Hospital",
                displayName: "Kokilaben Hospital",
                location: "Mumbai",
                score: 91,
                opdHours: "8:30 AM - 4:30 PM",
                primaryDoctorQualifications: "MD, FRCP",
            },
            {
                rank: 7,
                name: "Medanta - The Medicity",
                displayName: "Medanta Hospital",
                location: "Gurgaon",
                score: 93,
                opdHours: "10 AM - 6 PM",
                primaryDoctorQualifications: "MD, FACS",
            },
            {
                rank: 8,
                name: "Narayana Health",
                displayName: "Narayana Health",
                location: "Bangalore",
                score: 87,
                opdHours: "9 AM - 5 PM",
                primaryDoctorQualifications: "MBBS, MS",
            },
            {
                rank: 9,
                name: "Aster CMI Hospital",
                displayName: "Aster CMI Hospital",
                location: "Bangalore",
                score: 90,
                opdHours: "8 AM - 5 PM",
                primaryDoctorQualifications: "MD, DNB",
            },
            {
                rank: 10,
                name: "Jaslok Hospital",
                displayName: "Jaslok Hospital",
                location: "Mumbai",
                score: 86,
                opdHours: "9:30 AM - 6:30 PM",
                primaryDoctorQualifications: "MBBS, MD, DM",
            },
            {
                rank: 11,
                name: "Lilavati Hospital",
                displayName: "Lilavati Hospital",
                location: "Mumbai",
                score: 88,
                opdHours: "9 AM - 7 PM",
                primaryDoctorQualifications: "MD, FRCS",
            },
            {
                rank: 12,
                name: "Artemis Hospital",
                displayName: "Artemis Hospital",
                location: "Gurgaon",
                score: 89,
                opdHours: "10 AM - 5 PM",
                primaryDoctorQualifications: "MBBS, MS",
            },
            {
                rank: 13,
                name: "Global Hospital",
                displayName: "Global Hospital",
                location: "Chennai",
                score: 87,
                opdHours: "8:30 AM - 4:30 PM",
                primaryDoctorQualifications: "MD, DNB",
            },
            {
                rank: 14,
                name: "Ruby Hall Clinic",
                displayName: "Ruby Hall Clinic",
                location: "Pune",
                score: 85,
                opdHours: "9 AM - 6 PM",
                primaryDoctorQualifications: "MBBS, MD",
            },
            {
                rank: 15,
                name: "Sahyadri Hospital",
                displayName: "Sahyadri Hospital",
                location: "Pune",
                score: 86,
                opdHours: "10 AM - 7 PM",
                primaryDoctorQualifications: "MD, DM",
            },
            {
                rank: 16,
                name: "Apollo Gleneagles Hospital",
                displayName: "Apollo Gleneagles Hospital",
                location: "Kolkata",
                score: 88,
                opdHours: "9 AM - 5 PM",
                primaryDoctorQualifications: "MBBS, MS",
            },
            {
                rank: 17,
                name: "BLK Max Hospital",
                displayName: "BLK Max Hospital",
                location: "New Delhi",
                score: 90,
                opdHours: "8 AM - 6 PM",
                primaryDoctorQualifications: "MD, DNB",
            },
            {
                rank: 18,
                name: "Rainbow Children's Hospital",
                displayName: "Rainbow Children's Hospital",
                location: "Hyderabad",
                score: 92,
                opdHours: "9 AM - 5 PM",
                primaryDoctorQualifications: "MD, DCH",
            },
            {
                rank: 19,
                name: "Yashoda Hospitals",
                displayName: "Yashoda Hospitals",
                location: "Hyderabad",
                score: 89,
                opdHours: "10 AM - 4 PM",
                primaryDoctorQualifications: "MBBS, MD",
            },
            {
                rank: 20,
                name: "Kamineni Hospitals",
                displayName: "Kamineni Hospitals",
                location: "Hyderabad",
                score: 87,
                opdHours: "9 AM - 5 PM",
                primaryDoctorQualifications: "MD, FRCP",
            },
        ];

        const doctorData = [
            // Doctors for Apollo Hospital
            { hospital: "Apollo Hospital", name: "Dr. Anjali Sharma", specialty: "Cardiologist", opd: "Mon-Fri, 10 AM - 2 PM" },
            { hospital: "Apollo Hospital", name: "Dr. Rohan Gupta", specialty: "Neurologist", opd: "Tue-Sat, 11 AM - 3 PM" },
            { hospital: "Apollo Hospital", name: "Dr. Priya Singh", specialty: "Pediatrician", opd: "Mon-Wed-Fri, 9 AM - 1 PM" },
            { hospital: "Apollo Hospital", name: "Dr. Alok Kumar", specialty: "Orthopedic Surgeon", opd: "Mon-Thu, 2 PM - 6 PM" },

            // Doctors for Fortis Hospital
            { hospital: "Fortis Hospital", name: "Dr. Sameer Khan", specialty: "Dermatologist", opd: "Mon-Sat, 9 AM - 1 PM" },
            { hospital: "Fortis Hospital", name: "Dr. Neha Verma", specialty: "Endocrinologist", opd: "Tue-Fri, 10 AM - 2 PM" },
            { hospital: "Fortis Hospital", name: "Dr. Vikas Reddy", specialty: "General Surgeon", opd: "Mon-Thu, 1 PM - 5 PM" },
            { hospital: "Fortis Hospital", name: "Dr. Smita Rao", specialty: "Gynecologist", opd: "Wed-Sat, 9 AM - 1 PM" },

            // Doctors for Max Healthcare
            { hospital: "Max Healthcare", name: "Dr. Arjun Mehta", specialty: "Oncologist", opd: "Mon-Fri, 11 AM - 3 PM" },
            { hospital: "Max Healthcare", name: "Dr. Deepika Khanna", specialty: "Gastroenterologist", opd: "Tue-Thu, 10 AM - 1 PM" },
            { hospital: "Max Healthcare", name: "Dr. Rahul Sharma", specialty: "Urologist", opd: "Mon-Wed-Fri, 2 PM - 6 PM" },

            // Doctors for AIIMS
            { hospital: "AIIMS", name: "Dr. S. K. Gupta", specialty: "Neurosurgeon", opd: "Mon-Wed, 9 AM - 12 PM" },
            { hospital: "AIIMS", name: "Dr. Ritu Agarwal", specialty: "Opthalmologist", opd: "Tue-Thu, 10 AM - 1 PM" },
            { hospital: "AIIMS", name: "Dr. Manoj Kumar", specialty: "Nephrologist", opd: "Mon-Fri, 1 PM - 4 PM" },

            // Doctors for Manipal Hospital
            { hospital: "Manipal Hospital", name: "Dr. Kavita Singh", specialty: "Pulmonologist", opd: "Mon-Fri, 9 AM - 1 PM" },
            { hospital: "Manipal Hospital", name: "Dr. Rajesh Rao", specialty: "Rheumatologist", opd: "Tue-Thu, 10 AM - 2 PM" },
        ];


        // --- DOM Elements ---
        const appTitle = document.getElementById('appTitle');
        const loginAppTitle = document.getElementById('loginAppTitle');
        const loginPage = document.getElementById('loginPage');
        const hospitalSearchPage = document.getElementById('hospitalSearchPage');
        const doctorSearchPage = document.getElementById('doctorSearchPage');
        const chatbotPage = document.getElementById('chatbotPage');

        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const roleRadios = document.querySelectorAll('input[name="role"]');

        const backToHospitalsBtn = document.getElementById('backToHospitalsBtn');
        const backToDoctorsBtn = document.getElementById('backToDoctorsBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        const hospitalSearchInput = document.getElementById('hospitalSearchInput');
        const hospitalListDiv = document.getElementById('hospitalListDiv');
        const noHospitalsFound = document.getElementById('noHospitalsFound');

        const selectedHospitalName = document.getElementById('selectedHospitalName');
        const doctorSearchInput = document.getElementById('doctorSearchInput');
        const doctorListDiv = document.getElementById('doctorListDiv');
        const noDoctorsFound = document.getElementById('noDoctorsFound');

        const chatbotDoctorName = document.getElementById('chatbotDoctorName');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');


        // --- State Variables ---
        let loggedInUserRole = null; // 'patient' or 'doctor'
        let selectedHospital = null;
        let selectedDoctor = null;

        const CHAT_STATE = {
            IDLE: 'IDLE',
            WAITING_FOR_DATE: 'WAITING_FOR_DATE',
            WAITING_FOR_TIME: 'WAITING_FOR_TIME',
            CONFIRM_APPOINTMENT: 'CONFIRM_APPOINTMENT'
        };
        let chatState = CHAT_STATE.IDLE;
        let appointmentDetails = {
            date: null,
            time: null
        };

        // --- Utility Functions ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            updateNavButtons(pageId);
        }

        function updateNavButtons(currentPageId) {
            backToHospitalsBtn.classList.add('hidden');
            backToDoctorsBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden'); // Always visible once logged in

            if (currentPageId === 'hospitalSearchPage') {
                // No back button from main hospital page
            } else if (currentPageId === 'doctorSearchPage') {
                backToHospitalsBtn.classList.remove('hidden');
            } else if (currentPageId === 'chatbotPage') {
                backToHospitalsBtn.classList.remove('hidden');
                backToDoctorsBtn.classList.remove('hidden');
            } else if (currentPageId === 'loginPage') {
                logoutBtn.classList.add('hidden'); // Hide logout on login page
            }
        }

        function getDoctorDataHospitalName(hospitalDisplayName) {
            // Helper function to map display names to simpler names used in doctorData
            const mapping = {
                "Apollo Hospital": "Apollo Hospital",
                "Fortis Hospital": "Fortis Hospital",
                "Max Healthcare": "Max Healthcare",
                "AIIMS (All India Institute of Medical Sciences)": "AIIMS",
                "Manipal Hospital": "Manipal Hospital",
                "Kokilaben Hospital": "Kokilaben Dhirubhai Ambani Hospital", // Corrected mapping
                "Medanta Hospital": "Medanta - The Medicity",
                "Narayana Health": "Narayana Health",
                "Aster CMI Hospital": "Aster CMI Hospital",
                "Jaslok Hospital": "Jaslok Hospital",
                "Lilavati Hospital": "Lilavati Hospital",
                "Artemis Hospital": "Artemis Hospital",
                "Global Hospital": "Global Hospital",
                "Ruby Hall Clinic": "Ruby Hall Clinic",
                "Sahyadri Hospital": "Sahyadri Hospital",
                "Apollo Gleneagles Hospital": "Apollo Gleneagles Hospital",
                "BLK Max Hospital": "BLK Max Hospital",
                "Rainbow Children's Hospital": "Rainbow Children's Hospital",
                "Yashoda Hospitals": "Yashoda Hospitals",
                "Kamineni Hospitals": "Kamineni Hospitals",
            };
            return mapping[hospitalDisplayName] || hospitalDisplayName;
        }

        // --- Render Functions ---
        function renderHospitals(searchTerm = '') {
            const fragment = document.createDocumentFragment();
            const filteredHospitals = hospitalData.filter(hospital =>
                hospital.displayName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                hospital.location.toLowerCase().includes(searchTerm.toLowerCase())
            );

            if (filteredHospitals.length === 0) {
                noHospitalsFound.classList.remove('hidden');
                hospitalListDiv.querySelector('.card-list').innerHTML = ''; // Clear existing cards
            } else {
                noHospitalsFound.classList.add('hidden');
                filteredHospitals.forEach(hospital => {
                    const hospitalCard = document.createElement('div');
                    hospitalCard.className = 'card';
                    hospitalCard.innerHTML = `
                        <h3>${hospital.displayName}</h3>
                        <p><strong>Location:</strong> ${hospital.location}</p>
                        <p><strong>Score:</strong> ${hospital.score}/100</p>
                        <p><strong>OPD Hours:</strong> ${hospital.opdHours}</p>
                        <p><strong>Primary Doctor Q:</strong> ${hospital.primaryDoctorQualifications}</p>
                    `;
                    hospitalCard.addEventListener('click', () => {
                        selectedHospital = hospital;
                        selectedHospitalName.textContent = `Doctors at ${hospital.displayName}`;
                        doctorSearchInput.value = ''; // Clear doctor search input
                        renderDoctors(hospital.displayName);
                        showPage('doctorSearchPage');
                    });
                    fragment.appendChild(hospitalCard);
                });
                hospitalListDiv.querySelector('.card-list').innerHTML = ''; // Clear previous content
                hospitalListDiv.querySelector('.card-list').appendChild(fragment);
            }
        }

        function renderDoctors(hospitalDisplayName, searchTerm = '') {
            const fragment = document.createDocumentFragment();
            const doctorHospitalName = getDoctorDataHospitalName(hospitalDisplayName);
            const filteredDoctors = doctorData.filter(doctor =>
                doctor.hospital === doctorHospitalName &&
                (doctor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                 doctor.specialty.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            if (filteredDoctors.length === 0) {
                noDoctorsFound.classList.remove('hidden');
                doctorListDiv.querySelector('.card-list').innerHTML = '';
            } else {
                noDoctorsFound.classList.add('hidden');
                filteredDoctors.forEach(doctor => {
                    const doctorCard = document.createElement('div');
                    doctorCard.className = 'card';
                    doctorCard.innerHTML = `
                        <h3 class="text-accent-blue">${doctor.name}</h3>
                        <p class="doctor-specialty">${doctor.specialty}</p>
                        <p><strong>OPD:</strong> ${doctor.opd}</p>
                        <p><strong>Hospital:</strong> ${hospitalDisplayName}</p>
                    `;
                    doctorCard.addEventListener('click', () => {
                        selectedDoctor = doctor;
                        chatbotDoctorName.textContent = `Chat with Dr. ${doctor.name}`;
                        resetChatbot();
                        startChatbot();
                        showPage('chatbotPage');
                    });
                    fragment.appendChild(doctorCard);
                });
                doctorListDiv.querySelector('.card-list').innerHTML = '';
                doctorListDiv.querySelector('.card-list').appendChild(fragment);
            }
        }

        // --- Chatbot Functions ---
        function addChatMessage(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}`;
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
        }

        function resetChatbot() {
            chatMessages.innerHTML = '';
            chatInput.value = '';
            chatState = CHAT_STATE.IDLE;
            appointmentDetails = { date: null, time: null };
        }

        function startChatbot() {
            addChatMessage(`Hello! I'm the Healthcare Bot for Dr. ${selectedDoctor.name}. How may I assist you with booking an appointment?`, 'bot');
            chatState = CHAT_STATE.WAITING_FOR_DATE;
        }

        function parseDate(input) {
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize to start of day

            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            const dayAfterTomorrow = new Date(today);
            dayAfterTomorrow.setDate(today.getDate() + 2);

            input = input.toLowerCase();

            if (input.includes('today')) {
                return today;
            }
            if (input.includes('tomorrow')) {
                return tomorrow;
            }
            if (input.includes('day after tomorrow')) {
                return dayAfterTomorrow;
            }

            // Try to parse as DD-MM-YYYY or DD/MM/YYYY
            const dateMatch = input.match(/(\d{1,2})[-\/](\d{1,2})[-\/](\d{4})/);
            if (dateMatch) {
                const day = parseInt(dateMatch[1], 10);
                const month = parseInt(dateMatch[2], 10) - 1; // Month is 0-indexed
                const year = parseInt(dateMatch[3], 10);
                const parsed = new Date(year, month, day);
                if (parsed.toDateString() !== 'Invalid Date' && parsed >= today) { // Only allow future dates
                    return parsed;
                }
            }
            return null;
        }

        function parseTime(input) {
            input = input.toLowerCase();
            const timeMatch = input.match(/(\d{1,2})(:(\d{2}))?\s*(am|pm)?/);
            if (timeMatch) {
                let hours = parseInt(timeMatch[1], 10);
                const minutes = timeMatch[3] ? parseInt(timeMatch[3], 10) : 0;
                const ampm = timeMatch[4];

                if (ampm === 'pm' && hours < 12) hours += 12;
                if (ampm === 'am' && hours === 12) hours = 0; // 12 AM is 0 hours

                if (hours >= 0 && hours < 24 && minutes >= 0 && minutes < 60) {
                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                }
            }
            return null;
        }


        function handleChatbotInput(message) {
            addChatMessage(message, 'user');
            chatInput.value = '';

            switch (chatState) {
                case CHAT_STATE.WAITING_FOR_DATE:
                    const date = parseDate(message);
                    if (date && date >= new Date(new Date().setHours(0,0,0,0))) { // Ensure date is today or in the future
                        appointmentDetails.date = date;
                        addChatMessage("Great! What time would you like to book the appointment? (e.g., '10 AM', '14:30')", 'bot');
                        chatState = CHAT_STATE.WAITING_FOR_TIME;
                    } else {
                        addChatMessage("I'm sorry, I couldn't understand that date or it's in the past. Please provide a valid date (e.g., 'today', 'tomorrow', '25-12-2024').", 'bot');
                    }
                    break;
                case CHAT_STATE.WAITING_FOR_TIME:
                    const time = parseTime(message);
                    if (time) {
                        appointmentDetails.time = time;
                        const apptDate = appointmentDetails.date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                        addChatMessage(`You want to book an appointment with Dr. ${selectedDoctor.name} on ${apptDate} at ${appointmentDetails.time}. Is this correct? (Yes/No)`, 'bot');
                        chatState = CHAT_STATE.CONFIRM_APPOINTMENT;
                    } else {
                        addChatMessage("I'm sorry, I couldn't understand that time. Please provide a valid time (e.g., '10 AM', '2:30 PM', '14:30').", 'bot');
                    }
                    break;
                case CHAT_STATE.CONFIRM_APPOINTMENT:
                    if (message.toLowerCase() === 'yes') {
                        addChatMessage("Excellent! Your appointment has been successfully booked. You will receive a confirmation shortly.", 'bot');
                        addChatMessage("Is there anything else I can help you with?", 'bot');
                        chatState = CHAT_STATE.IDLE; // Reset to idle or offer more options
                        // In a real app, you'd send this to a backend
                    } else if (message.toLowerCase() === 'no') {
                        addChatMessage("Okay, let's restart. What date would you like to book the appointment for?", 'bot');
                        chatState = CHAT_STATE.WAITING_FOR_DATE;
                        appointmentDetails = { date: null, time: null }; // Clear details
                    } else {
                        addChatMessage("Please respond with 'Yes' or 'No'.", 'bot');
                    }
                    break;
                case CHAT_STATE.IDLE:
                default:
                    addChatMessage("I'm sorry, I'm currently not in a booking flow. Would you like to start booking an appointment?", 'bot');
                    // Could add logic to detect "book appointment" and restart
                    break;
            }
        }

        // --- Event Listeners ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            const role = document.querySelector('input[name="role"]:checked').value;

            // Basic validation
            if (username && password) {
                loggedInUserRole = role;
                renderHospitals(); // Initial render of hospitals
                showPage('hospitalSearchPage');
            } else {
                alert('Please enter both username and password.');
            }
        });

        hospitalSearchInput.addEventListener('input', (e) => {
            renderHospitals(e.target.value);
        });

        doctorSearchInput.addEventListener('input', (e) => {
            if (selectedHospital) {
                renderDoctors(selectedHospital.displayName, e.target.value);
            }
        });

        sendChatBtn.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message) {
                handleChatbotInput(message);
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatBtn.click();
            }
        });

        backToHospitalsBtn.addEventListener('click', () => {
            selectedHospital = null;
            selectedDoctor = null;
            hospitalSearchInput.value = ''; // Clear search input
            renderHospitals();
            resetChatbot();
            showPage('hospitalSearchPage');
        });

        backToDoctorsBtn.addEventListener('click', () => {
            selectedDoctor = null;
            doctorSearchInput.value = ''; // Clear search input
            if (selectedHospital) {
                renderDoctors(selectedHospital.displayName);
            }
            resetChatbot();
            showPage('doctorSearchPage');
        });

        logoutBtn.addEventListener('click', () => {
            loggedInUserRole = null;
            selectedHospital = null;
            selectedDoctor = null;
            resetChatbot();
            loginForm.reset(); // Clear login form fields
            usernameInput.value = ''; // Ensure specific clear
            passwordInput.value = ''; // Ensure specific clear
            document.querySelector('input[name="role"][value="patient"]').checked = true; // Reset radio
            showPage('loginPage');
        });

        // --- Initial Setup ---
        appTitle.textContent = APP_NAME;
        loginAppTitle.textContent = APP_NAME;
        showPage('loginPage'); // Start on the login page
    </script>
</body>
</html>
