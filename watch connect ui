<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthCare Connect | Smart Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --opal-blue: #e8f0fe;
            --opal-green: #e6f4ea;
            --google-blue: #1a73e8;
            --google-green: #1e8e3e;
            --vibrant-purple: #8ab4f8;
            --vibrant-pink: #f28b82;
        }

        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #3c4043;
            overflow: hidden;
        }

        .opal-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .opal-card:hover {
            transform: translateY(-5px);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid #e0e0e0;
        }

        .chat-bubble {
            max-width: 85%;
            padding: 14px 20px;
            border-radius: 20px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-bubble {
            background-color: var(--google-blue);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .bot-bubble {
            background-color: #ffffff;
            color: #3c4043;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .active-tab {
            color: var(--google-blue);
            background-color: var(--opal-blue);
            border-radius: 12px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #dadce0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #bdc1c6; }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #9aa0a6;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden bg-[#f0f4f9]">

    <!-- Navbar -->
    <nav class="glass-nav sticky top-0 z-50 px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white">
                <i class="fas fa-hand-holding-medical text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg text-gray-800 tracking-tight">HealthCare <span class="text-blue-600">Connect</span></h1>
                <p class="text-[10px] text-gray-400 font-medium uppercase tracking-widest">Smart Assistant</p>
            </div>
        </div>

        <div class="hidden md:flex bg-gray-100 rounded-2xl p-1 gap-1">
            <button onclick="toggleView('dashboard')" id="btn-dashboard" class="px-5 py-2 text-sm font-medium transition-all active-tab">Dashboard</button>
            <button onclick="toggleView('assistant')" id="btn-assistant" class="px-5 py-2 text-sm font-medium transition-all text-gray-500 hover:text-blue-600">Assistant</button>
            <button onclick="toggleView('records')" id="btn-records" class="px-5 py-2 text-sm font-medium transition-all text-gray-500 hover:text-blue-600">Medical Records</button>
        </div>

        <div class="flex items-center gap-4">
            <button class="relative p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors">
                <i class="far fa-bell text-xl"></i>
                <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
            </button>
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-indigo-600 p-0.5">
                <img src="https://ui-avatars.com/api/?name=Alex+Johnson&background=random" class="w-full h-full rounded-full border-2 border-white shadow-sm" alt="User">
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow overflow-hidden relative">
        
        <!-- DASHBOARD VIEW (Merged UI) -->
        <div id="view-dashboard" class="h-full overflow-y-auto p-6 transition-all duration-300">
            <div class="max-w-6xl mx-auto space-y-8">
                
                <!-- Welcome Section -->
                <section class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                    <div>
                        <h2 id="time-greeting" class="text-3xl font-bold text-gray-800">Good Morning, Alex!</h2>
                        <p class="text-gray-500 mt-1">Here's a summary of your health journey today.</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="bg-white px-4 py-2 rounded-xl shadow-sm text-sm font-medium text-gray-600 hover:bg-gray-50 flex items-center gap-2 border border-gray-100">
                            <i class="far fa-calendar"></i> Jan 24, 2024
                        </button>
                        <button onclick="toggleView('assistant')" class="bg-blue-600 px-4 py-2 rounded-xl shadow-md text-sm font-medium text-white hover:bg-blue-700 flex items-center gap-2">
                            <i class="fas fa-plus"></i> New Inquiry
                        </button>
                    </div>
                </section>

                <!-- Status Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="opal-card p-6 bg-gradient-to-br from-blue-50 to-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600">
                                <i class="fas fa-heartbeat text-xl"></i>
                            </div>
                            <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full uppercase">Normal</span>
                        </div>
                        <p class="text-sm font-medium text-gray-500">Avg. Heart Rate</p>
                        <div class="flex items-end gap-2 mt-1">
                            <h3 class="text-3xl font-bold text-gray-800">72</h3>
                            <span class="text-gray-400 font-medium mb-1">bpm</span>
                        </div>
                    </div>

                    <div class="opal-card p-6 bg-gradient-to-br from-green-50 to-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center text-green-600">
                                <i class="fas fa-walking text-xl"></i>
                            </div>
                            <span class="text-[10px] font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full uppercase">On Track</span>
                        </div>
                        <p class="text-sm font-medium text-gray-500">Steps Today</p>
                        <div class="flex items-end gap-2 mt-1">
                            <h3 class="text-3xl font-bold text-gray-800">8,432</h3>
                            <span class="text-gray-400 font-medium mb-1">/ 10k</span>
                        </div>
                    </div>

                    <div class="opal-card p-6 bg-gradient-to-br from-purple-50 to-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-600">
                                <i class="fas fa-moon text-xl"></i>
                            </div>
                            <span class="text-[10px] font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded-full uppercase">Great</span>
                        </div>
                        <p class="text-sm font-medium text-gray-500">Sleep Score</p>
                        <div class="flex items-end gap-2 mt-1">
                            <h3 class="text-3xl font-bold text-gray-800">85</h3>
                            <span class="text-gray-400 font-medium mb-1">/ 100</span>
                        </div>
                    </div>
                </div>

                <!-- Main Layout Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left: Appointments -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-bold text-gray-800">Upcoming Appointments</h3>
                            <button class="text-blue-600 text-sm font-medium hover:underline">View Calendar</button>
                        </div>
                        
                        <div id="appointments-list" class="space-y-4">
                            <!-- Populated by JS -->
                        </div>

                        <!-- Health Tip -->
                        <div class="bg-indigo-600 rounded-3xl p-8 text-white relative overflow-hidden shadow-xl">
                            <div class="relative z-10">
                                <span class="bg-indigo-500 text-[10px] font-bold uppercase px-3 py-1 rounded-full">Pro Tip</span>
                                <h4 class="text-2xl font-bold mt-4 max-w-sm leading-tight">Stay hydrated to improve focus and energy levels.</h4>
                                <p class="text-indigo-100 mt-2 text-sm opacity-90">Aim for 8 glasses of water daily for optimal health.</p>
                                <button class="mt-6 bg-white text-indigo-600 px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg hover:bg-gray-50 transition-colors">Log Water Intake</button>
                            </div>
                            <i class="fas fa-tint absolute -right-4 -bottom-4 text-9xl text-indigo-500 opacity-20 transform -rotate-12"></i>
                        </div>
                    </div>

                    <!-- Right: Quick Actions & Assistant Preview -->
                    <div class="space-y-6">
                        <h3 class="text-xl font-bold text-gray-800">Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="opal-card p-4 flex flex-col items-center text-center gap-3 hover:bg-blue-50 transition-colors group">
                                <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform">
                                    <i class="fas fa-file-prescription"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-700">Refill Rx</span>
                            </button>
                            <button class="opal-card p-4 flex flex-col items-center text-center gap-3 hover:bg-green-50 transition-colors group">
                                <div class="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 group-hover:scale-110 transition-transform">
                                    <i class="fas fa-video"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-700">Telehealth</span>
                            </button>
                            <button class="opal-card p-4 flex flex-col items-center text-center gap-3 hover:bg-red-50 transition-colors group">
                                <div class="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center text-red-600 group-hover:scale-110 transition-transform">
                                    <i class="fas fa-microscope"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-700">Labs</span>
                            </button>
                            <button class="opal-card p-4 flex flex-col items-center text-center gap-3 hover:bg-purple-50 transition-colors group">
                                <div class="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition-transform">
                                    <i class="fas fa-pills"></i>
                                </div>
                                <span class="text-xs font-bold text-gray-700">Meds Log</span>
                            </button>
                        </div>

                        <div class="opal-card p-6 bg-[#f8f9fa] border-dashed border-2">
                            <h4 class="font-bold text-gray-800 mb-2">Need help?</h4>
                            <p class="text-sm text-gray-500 mb-4">Ask our AI assistant about symptoms, medicines, or your records.</p>
                            <div onclick="toggleView('assistant')" class="bg-white border rounded-xl p-3 flex items-center justify-between cursor-pointer hover:shadow-md transition-shadow">
                                <span class="text-gray-400 text-sm">Ask anything...</span>
                                <i class="fas fa-paper-plane text-blue-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASSISTANT VIEW (Architecture from mainchatbot3) -->
        <div id="view-assistant" class="hidden h-full flex flex-col p-4 md:p-6">
            <div class="max-w-4xl mx-auto w-full h-full flex flex-col bg-white rounded-[32px] shadow-sm overflow-hidden border border-gray-100">
                
                <!-- Chat Header -->
                <div class="px-6 py-4 border-b flex items-center justify-between bg-white">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center text-blue-600">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">AI Health Assistant</h3>
                            <div class="flex items-center gap-1.5">
                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                <span class="text-[10px] text-gray-500 font-medium uppercase tracking-wider">Ready to assist</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="clearChat()" class="text-gray-400 hover:text-red-500 text-sm font-medium transition-colors">Clear</button>
                </div>

                <!-- Chat Messages -->
                <div id="chat-container" class="flex-grow overflow-y-auto p-6 flex flex-col gap-2">
                    <div class="bot-bubble chat-bubble">
                        Hello Alex! I'm your HealthCare Connect assistant. I can help you understand your medical reports, check symptoms, or schedule appointments. How can I help you today?
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typing-indicator" class="hidden px-6 py-2">
                    <div class="bot-bubble chat-bubble inline-flex gap-1 py-3 px-5">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="p-4 bg-gray-50/50">
                    <div class="max-w-3xl mx-auto flex items-end gap-2 bg-white p-2 rounded-2xl shadow-sm border border-gray-200">
                        <button id="record-btn" class="p-3 text-gray-400 hover:text-blue-600 transition-colors">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <textarea id="user-input" rows="1" class="flex-grow py-3 px-2 focus:outline-none resize-none text-gray-700 bg-transparent" placeholder="Type your health inquiry..."></textarea>
                        <button onclick="handleSend()" class="p-3 bg-blue-600 text-white rounded-xl shadow-md hover:bg-blue-700 transition-all">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <p class="text-[10px] text-center text-gray-400 mt-2">Assistant can provide health information but is not a substitute for professional medical advice.</p>
                </div>
            </div>
        </div>

        <!-- RECORDS VIEW -->
        <div id="view-records" class="hidden h-full overflow-y-auto p-6">
            <div class="max-w-5xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">Medical Records</h2>
                    <button onclick="document.getElementById('file-upload').click()" class="bg-blue-600 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-md hover:bg-blue-700 transition-all flex items-center gap-2">
                        <i class="fas fa-cloud-upload-alt"></i> Upload New Report
                    </button>
                    <input type="file" id="file-upload" class="hidden" accept="image/*,.pdf" onchange="handleFileUpload(event)">
                </div>

                <div id="records-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Sample Card -->
                    <div class="opal-card p-6 border-l-4 border-blue-500">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-medical-alt"></i>
                            </div>
                            <span class="text-[10px] text-gray-400">Oct 12, 2023</span>
                        </div>
                        <h4 class="font-bold text-gray-800">Annual Blood Work</h4>
                        <p class="text-xs text-gray-500 mt-1">General Health Checkup</p>
                        <div class="mt-6 pt-4 border-t flex items-center justify-between">
                            <button class="text-blue-600 text-xs font-bold uppercase tracking-wider">View Full</button>
                            <button class="text-gray-400 hover:text-blue-600 transition-colors"><i class="fas fa-share-alt"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script>
        const apiKey = ""; // Runtime provides key
        let isRecording = false;
        let recognition = null;

        // Shared Data
        let appointments = [
            { id: '1', doctor: 'Dr. Sarah Jenkins', specialty: 'Cardiologist', hospital: 'General Hospital', date: '2024-01-28', time: '10:30 AM', type: 'Checkup' },
            { id: '2', doctor: 'Dr. Michael Chen', specialty: 'Dermatologist', hospital: 'Skin Care Clinic', date: '2024-02-05', time: '02:15 PM', type: 'Consultation' }
        ];

        // UI Management
        function toggleView(view) {
            const views = ['dashboard', 'assistant', 'records'];
            views.forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`btn-${v}`).classList.remove('active-tab');
                document.getElementById(`btn-${v}`).classList.add('text-gray-500');
            });

            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.getElementById(`btn-${view}`).classList.add('active-tab');
            document.getElementById(`btn-${view}`).classList.remove('text-gray-500');

            if (view === 'dashboard') renderAgenda();
        }

        // Dashboard Logic
        function renderAgenda() {
            const list = document.getElementById('appointments-list');
            if (!list) return;
            
            list.innerHTML = '';
            
            if (appointments.length === 0) {
                list.innerHTML = `<div class="p-10 text-center text-gray-400 bg-white rounded-3xl border-2 border-dashed">No upcoming appointments.</div>`;
                return;
            }

            appointments.forEach(app => {
                const dateObj = new Date(app.date);
                const month = dateObj.toLocaleString('default', { month: 'short' });
                const day = dateObj.getDate();

                const div = document.createElement('div');
                div.className = "opal-card p-4 flex items-center gap-4 group";
                div.innerHTML = `
                    <div class="bg-blue-50 text-blue-600 p-3 rounded-2xl text-center min-w-[65px]">
                        <p class="text-[10px] font-bold uppercase tracking-tighter">${month}</p>
                        <p class="text-2xl font-bold">${day}</p>
                    </div>
                    <div class="flex-grow">
                        <div class="flex items-center gap-2">
                            <p class="font-bold text-gray-800">${app.doctor}</p>
                            <span class="text-[9px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded-md font-bold uppercase">${app.type}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-0.5">${app.hospital} â€¢ ${app.time}</p>
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="editAppt('${app.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-blue-600"><i class="fas fa-edit text-xs"></i></button>
                        <button onclick="cancelAppt('${app.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:bg-red-50 hover:text-red-500"><i class="fas fa-trash text-xs"></i></button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function cancelAppt(id) {
            appointments = appointments.filter(a => a.id !== id);
            renderAgenda();
        }

        // Assistant Logic
        async function handleSend() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';

            const typing = document.getElementById('typing-indicator');
            typing.classList.remove('hidden');
            
            try {
                const response = await fetchGemini(message);
                typing.classList.add('hidden');
                addMessage(response, 'bot');
            } catch (err) {
                typing.classList.add('hidden');
                addMessage("I'm sorry, I'm having trouble connecting to my knowledge base. Please try again later.", 'bot');
            }
        }

        function addMessage(text, role) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `${role === 'user' ? 'user-bubble' : 'bot-bubble'} chat-bubble`;
            
            // Format markdown-style bolding
            div.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function fetchGemini(prompt) {
            const systemPrompt = "You are an expert HealthCare Assistant for HealthCare Connect. Provide accurate, empathetic, and concise medical information. Always remind the user to consult a doctor for clinical diagnosis. Use friendly professional tone.";
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            let retries = 0;
            const maxRetries = 5;
            
            while(retries < maxRetries) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't generate a response.";
                } catch (e) {
                    retries++;
                    await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
                }
            }
            throw new Error("Failed after retries");
        }

        function clearChat() {
            const container = document.getElementById('chat-container');
            container.innerHTML = `
                <div class="bot-bubble chat-bubble">
                    Chat cleared. How else can I assist you today?
                </div>
            `;
        }

        // Records Logic
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const grid = document.getElementById('records-grid');
            const div = document.createElement('div');
            div.className = "opal-card p-6 border-l-4 border-green-500 animate-pulse";
            div.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div class="w-10 h-10 bg-green-50 text-green-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </div>
                <h4 class="font-bold text-gray-800">Processing...</h4>
                <p class="text-xs text-gray-500 mt-1">${file.name}</p>
            `;
            grid.prepend(div);

            // Mock Processing
            setTimeout(() => {
                div.classList.remove('animate-pulse', 'border-green-500');
                div.classList.add('border-blue-500');
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-medical-alt"></i>
                        </div>
                        <span class="text-[10px] text-gray-400">Just Now</span>
                    </div>
                    <h4 class="font-bold text-gray-800">${file.name.split('.')[0]}</h4>
                    <p class="text-xs text-gray-500 mt-1">Uploaded via Dashboard</p>
                    <div class="mt-6 pt-4 border-t flex items-center justify-between">
                        <button class="text-blue-600 text-xs font-bold uppercase tracking-wider">View Full</button>
                        <button class="text-gray-400 hover:text-blue-600 transition-colors"><i class="fas fa-share-alt"></i></button>
                    </div>
                `;
            }, 2000);
        }

        // Voice Recognition
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                isRecording = true;
                document.getElementById('record-btn').classList.add('text-red-500', 'animate-pulse');
            };

            recognition.onend = () => {
                isRecording = false;
                document.getElementById('record-btn').classList.remove('text-red-500', 'animate-pulse');
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('user-input').value = text;
                handleSend();
            };
        }

        document.getElementById('record-btn').addEventListener('click', () => {
            if (!recognition) return;
            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        // Initialize
        window.onload = () => {
            const hour = new Date().getHours();
            const greeting = hour < 12 ? "Good Morning" : hour < 18 ? "Good Afternoon" : "Good Evening";
            const greetingEl = document.getElementById('time-greeting');
            if (greetingEl) greetingEl.innerText = `${greeting}, Alex!`;

            renderAgenda();

            const textarea = document.getElementById('user-input');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            textarea.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                }
            });
        };
    </script>
</body>
</html>
